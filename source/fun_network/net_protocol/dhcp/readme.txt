/**
Dynamic Host Configuration Protocol 动态主机配置协议
主机发送请求消息到DHCP服务器的68号端口，DHCP服务器回应应答消息给主机的67号端口。
based on UDP
*/

1.报文类型

dhcp共有8种报文


报文类型                                        说明

Discover（0x01）	DHCP客户端在请求IP地址时并不知道DHCP服务器的位置，因此DHCP客户端会在本地网络
                    内以广播方式发送Discover请求报文，以发现网络中的DHCP服务器。所有收到Discover
                    报文的DHCP服务器都会发送应答报文，DHCP客户端据此可以知道网络中存在的DHCP服务
                    器的位置。


Offer（0x02）	    DHCP服务器收到Discover报文后，就会在所配置的地址池中查找一个合适的IP地址，加
                    上相应的租约期限和其他配置信息（如网关、DNS服务器等），构造一个Offer报文，发
                    送给DHCP客户端，告知用户本服务器可以为其提供IP地址。但这个报文只是告诉DHCP客
                    户端可以提供IP地址，最终还需要客户端通过ARP来检测该IP地址是否重复。


Request（0x03）	    DHCP客户端可能会收到很多Offer请求报文，所以必须在这些应答中选择一个。通常是选
                    择第一个Offer应答报文的服务器作为自己的目标服务器，并向该服务器发送一个广播的
                    Request请求报文，通告选择的服务器，希望获得所分配的IP地址。另外，DHCP客户端在
                    成功获取IP地址后，在地址使用租期达到50%时，会向DHCP服务器发送单播Request请求报
                    文请求续延租约，如果没有收到ACK报文，在租期达到87.5%时，会再次发送广播的Request
                    请求报文以请求续延租约。


ACK（0x05）	        DHCP服务器收到Request请求报文后，根据Request报文中携带的用户MAC来查找有没有相应
                    的租约记录，如果有则发送ACK应答报文，通知用户可以使用分配的IP地址。


NAK（0x06）	        如果DHCP服务器收到Request请求报文后，没有发现有相应的租约记录或者由于某些原因无
                    法正常分配IP地址，则向DHCP客户端发送NAK应答报文，通知用户无法分配合适的IP地址。


Release（0x07）	    当DHCP客户端不再需要使用分配IP地址时（一般出现在客户端关机、下线等状况）就会主动
                    向DHCP服务器发送RELEASE请求报文，告知服务器用户不再需要分配IP地址，请求DHCP服务器
                    释放对应的IP地址。


Decline（0x04）	    DHCP客户端收到DHCP服务器ACK应答报文后，通过地址冲突检测发现服务器分配的地址冲突或
                    者由于其他原因导致不能使用，则会向DHCP服务器发送Decline请求报文，通知服务器所分配
                    的IP地址不可用，以期获得新的IP地址。


Inform（0x08）	    DHCP客户端如果需要从DHCP服务器端获取更为详细的配置信息，则向DHCP服务器发送Inform请
                    求报文；DHCP服务器在收到该报文后，将根据租约进行查找到相应的配置信息后，向DHCP客户
                    端发送ACK应答报文。目前基本上不用了。


2.工作流程

            server1                   client                    server2
              |                         |                           |
              |                         |                           |
              |<--discover报文(广播)--- |-----discover报文(广播)--->|
              |                         |                           |
              |----offer(报文)--------->|<-----offer(报文)----------|
              |                         |                           |
              |<---request(报文)--------|------request(报文)------->|
              |                         |                           |
              |                         |<------ack(报文)-----------|
              |                         |                           |
              |                         |-----decline(报文)-------->|
              |                         |                           |
              |                         |------release(报文)------->|

3.报文格式

                int(4字节)
---------------------------------------------------------
|  op(1byte) | htype(1byte) | hlen(1byte) | hops(1byte) |
---------------------------------------------------------
|                       xid(4byte)                      |
---------------------------------------------------------
|       secs(2byte)         |       flags(2byte)        |
---------------------------------------------------------
|                       ciaddr(4byte)                   |
---------------------------------------------------------
|                       yiaddr(4byte)                   |
---------------------------------------------------------
|                       siaddr(4byte)                   |
---------------------------------------------------------
|                       giaddr(4byte)                   |
---------------------------------------------------------
|                       chaddr(4byte)                   |
---------------------------------------------------------
|                       sname(64byte)                   |
---------------------------------------------------------
|                       file(128byte)                   |
---------------------------------------------------------
|                       options(可变长)                 |
---------------------------------------------------------

字段解释

op：         报文的操作类型。分为请求报文和响应报文。1：请求报文，2：应答报文。
             即client送给server的封包，设为1，反之为2。
             请求报文：DHCP Discover、DHCP Request、DHCP Release、DHCP Inform和DHCP Decline。
             应答报文：DHCP Offer、DHCP ACK和DHCP NAK。

htype：      DHCP客户端的MAC地址类型。MAC地址类型其实是指明网络类型。htype值为1时表示为最常见的
             以太网MAC地址类型。

hlen：       DHCP客户端的MAC地址长度。以太网MAC地址长度为6个字节，即以太网时hlen值为6。

hops：       DHCP报文经过的DHCP中继的数目，默认为0。DHCP请求报文每经过一个DHCP中继，该字段就会增加1。
             没有经过DHCP中继时值为0。(若数据包需经过router传送，每站加1，若在同一网内，为0。)

xid：        客户端通过DHCP Discover报文发起一次IP地址请求时选择的随机数，相当于请求标识。用来标识一次
             IP地址请求过程。在一次请求中所有报文的Xid都是一样的。

secs：       DHCP客户端从获取到IP地址或者续约过程开始到现在所消耗的时间，以秒为单位。在没有获得IP地址前
             该字段始终为0。(DHCP客户端开始DHCP请求后所经过的时间。目前尚未使用，固定为0。)

flags：      标志位，只使用第0比特位，是广播应答标识位，用来标识DHCP服务器应答报文是采用单播还是广播发送，
             0表示采用单播发送方式，1表示采用广播发送方式。其余位尚未使用。(即从0-15bits，最左1bit为1时表
             示server将以广播方式传送封包给client。)

             注意：在客户端正式分配了IP地址之前的第一次IP地址请求过程中，所有DHCP报文都是以广播方式发送的，
             包括客户端发送的DHCP Discover和DHCP Request报文，以及DHCP服务器发送的DHCP Offer、DHCP ACK和
             DHCP NAK报文。当然，如果是由DHCP中继器转的报文，则都是以单播方式发送的。另外，IP地址续约、IP
             地址释放的相关报文都是采用单播方式进行发送的。

ciaddr：     DHCP客户端的IP地址。仅在DHCP服务器发送的ACK报文中显示，因为在得到DHCP服务器确认前，DHCP客户
             端是还没有分配到IP地址的。在其他报文中均显示，只有客户端是Bound、Renew、Rebinding状态，并且
             能响应ARP请求时，才能被填充。

yiaddr：     DHCP服务器分配给客户端的IP地址。仅在DHCP服务器发送的Offer和ACK报文中显示，其他报文中显示为0。

siaddr：     下一个为DHCP客户端分配IP地址等信息的DHCP服务器IP地址。仅在DHCP Offer、DHCP ACK报文中显示，
             其他报文中显示为0。(用于bootstrap过程中的IP地址)

             一般来说是服务器的ip地址.但是注意！根据openwrt源码给出的注释，当报文的源地址、
             siaddr、option­>server_id字段不一致（有经过跨子网转发）时，通常认为option­>srever_id
             字段为真正的服务器ip，siaddr有可能是多次路由跳转中的某一个路由的ip

giaddr：     DHCP客户端发出请求报文后经过的第一个DHCP中继的IP地址。如果没有经过DHCP中继，则显示为0。
            (转发代理（网关）IP地址)

chaddr：     DHCP客户端的MAC地址。在每个报文中都会显示对应DHCP客户端的MAC地址。

sname：      为DHCP客户端分配IP地址的DHCP服务器名称（DNS域名格式）。在Offer和ACK报文中显示发送报文的DHCP
             服务器名称，其他报文显示为0。

file：       DHCP服务器为DHCP客户端指定的启动配置文件名称及路径信息。仅在DHCP Offer报文中显示，其他报文中
             显示为空。

options：    可选项字段，长度可变，格式为"代码+长度+数据"

options 选项

代码	    长度（字节）	                说明

1	            4	                        子网掩码

3	        长度可变，必须是4字节的倍数	    默认网关（可以是一个路由器IP地址列表）

6	        长度可变，必须是4字节的倍数	    DNS服务器（可以是一个DNS服务器IP地址列表）

15	        长度可变	                    域名称（主DNS服务器名称）

42	        长度可变，必须是4字节的倍数	    NTP服务器（可以是一个NTP服务器IP地址列表）

44	        长度可变，必须是4字节的倍数	    WINS服务器（可以是一个WINS服务器IP地址列表）

51	        4	                            有效租约期（以秒为单位）

53	        1	                            报文类型（1 ~ 8）分别表示：
                                            Discover，Offer，Request，Decline，ACK，NAK，Release，Inform

58	        4	                            续约时间

60	        长度可变	                    Authentication for DHCP Message，
                                            用来完成基于标准DHCP协议，以在客户端输入用户名和密码的方式进
                                            行地址鉴权主要用在按用户认证收费场合，与之对应的是pppoe认证计
                                            费

255	0	标记options结束
